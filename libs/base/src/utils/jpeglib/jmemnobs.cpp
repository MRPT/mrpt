/* +------------------------------------------------------------------------+
   |                     Mobile Robot Programming Toolkit (MRPT)            |
   |                          http://www.mrpt.org/                          |
   |                                                                        |
   | Copyright (c) 2005-2017, Individual contributors, see AUTHORS file     |
   | See: http://www.mrpt.org/Authors - All rights reserved.                |
   | Released under BSD License. See details in http://www.mrpt.org/License |
   +------------------------------------------------------------------------+ */

#define JPEG_INTERNALS
#include "jinclude.h"
#include "mrpt_jpeglib.h"
#include "jmemsys.h" /* import the system-dependent declarations */

#ifndef HAVE_STDLIB_H /* <stdlib.h> should declare malloc(),free() */
extern void* malloc JPP((size_t size));
extern void free JPP((void* ptr));
#endif

/*
 * Memory allocation and freeing are controlled by the regular library
 * routines malloc() and free().
 */

GLOBAL(void*)
jpeg_get_small(j_common_ptr, size_t sizeofobject)
{
	return (void*)malloc(sizeofobject);
}

GLOBAL(void)
jpeg_free_small(j_common_ptr, void* object, size_t) { free(object); }
/*
 * "Large" objects are treated the same as "small" ones.
 * NB: although we include FAR keywords in the routine declarations,
 * this file won't actually work in 80x86 small/medium model; at least,
 * you probably won't be able to process useful-size images in only 64KB.
 */

GLOBAL(void FAR*)
jpeg_get_large(j_common_ptr, size_t sizeofobject)
{
	return (void FAR*)malloc(sizeofobject);
}

GLOBAL(void)
jpeg_free_large(j_common_ptr, void FAR* object, size_t) { free(object); }
/*
 * This routine computes the total memory space available for allocation.
 * Here we always say, "we got all you want bud!"
 */

GLOBAL(long)
jpeg_mem_available(j_common_ptr, long, long max_bytes_needed, long)
{
	return max_bytes_needed;
}

/*
 * Backing store (temporary file) management.
 * Since jpeg_mem_available always promised the moon,
 * this should never be called and we can just error out.
 */

GLOBAL(void)
jpeg_open_backing_store(j_common_ptr cinfo, backing_store_ptr, long)
{
	ERREXIT(cinfo, JERR_NO_BACKING_STORE);
}

/*
 * These routines take care of any system-dependent initialization and
 * cleanup required.  Here, there isn't any.
 */

GLOBAL(long)
jpeg_mem_init(j_common_ptr) { return 0; /* just set max_memory_to_use to 0 */ }
GLOBAL(void)
jpeg_mem_term(j_common_ptr) { /* no work */}
